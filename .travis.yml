dist: xenial
sudo: required
git:
  depth: 3
addons:
  apt:
    packages:
     - curl
    update:
     - true
before_install:
  - sudo apt-get update -qq
  - git clone https://android.googlesource.com/platform/prebuilts/gcc/linux-x86/aarch64/aarch64-linux-android-4.9 ~/aarch64-linux-android-4.9/
  - sudo chmod -R a+x *
script:
  - export ARCH=arm64
  - export CROSS_COMPILE=~/aarch64-linux-android-4.9/bin/aarch64-linux-android-
  - KERNEL_DIR=$PWD/kernel_huawei_msm8937
  - ZIMAGE=$KERNEL_DIR/arch/arm64/boot/Image.gz-dtb
  - export KBUILD_BUILD_USER="ALGPHELLO"
  - export KBUILD_BUILD_HOST="fujitsu"
  - cd $KERNEL_DIR
  #- make ARCH=arm64 merge_msm8937_64_defconfig
  - make ARCH=arm64 msmcortex_defconfig
  - make ARCH=arm64 Image.gz-dtb
  
after_success:
  - cd $KERNEL_DIR
  - cp arch/arm64/boot/Image* $HOME/Image.gz-dtb
deploy:
  skip_cleanup: true
  provider: releases
  api_key: "$GitOAUTHToken_KERNEL"
  file_glob: true
  file: $KERNEL_DIR/arch/arm64/boot/*Image*
  on:
    tags: false
    repo: algphello/kernel_huawei_msm8937
    branch: master
branches:
  except:
- /^(?i:untagged)-.*$/
